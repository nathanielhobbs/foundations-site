{% extends "base.html" %}
{% block title %}Notebooks{% endblock %}

{% block content %}
<h2>Notebooks</h2>
<div id="nbContainer" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px;"></div>
<div id="nbEmpty" style="display:none;">No notebooks found.</div>
{% endblock %}

{% block extra_scripts %}
<script>
(async function(){
  try {
    // Admin can pass ?section=5 etc.; students ignore
    const res = await fetch(window.location.search ? '/api/notebooks' + window.location.search : '/api/notebooks');
    const data = await res.json();
    const wrap = document.getElementById('nbContainer');
    const empty = document.getElementById('nbEmpty');

    if (!data.success || !data.items || !data.items.length) {
      wrap.style.display = 'none'; empty.style.display = 'block'; return;
    }
    wrap.innerHTML = '';
    data.items.forEach(it => {
      const card = document.createElement('div');
      card.style.border = '1px solid #ccc';
      card.style.borderRadius = '10px';
      card.style.padding = '12px';
      card.style.background = 'var(--bg)';
      card.style.color = 'var(--text)';
      card.innerHTML = `
        <div style="font-weight:600; margin-bottom:.25rem;">${it.title}</div>
        <div class="muted" style="font-size:.9rem; margin-bottom:.5rem;">Updated: ${it.date ? new Date(it.date).toLocaleString() : 'â€”'}</div>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
          <a class="btn" style="border:1px solid #bbb; border-radius:7px; padding:.35rem .7rem; text-decoration:none;" href="https://github.com/${it.github_path}" target="_blank" rel="noopener">View on GitHub</a>
          <a class="btn" style="border:1px solid #bbb; border-radius:7px; padding:.35rem .7rem; text-decoration:none;" href="${it.download_url}" download>Download .ipynb</a>
        </div>`;
      wrap.appendChild(card);
    });
  } catch (e) {
    document.getElementById('nbContainer').innerHTML = `<div class="muted">Error loading notebooks.</div>`;
  }
})();
</script>
{% endblock %}

